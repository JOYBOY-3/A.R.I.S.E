<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel</title>
  <link rel="stylesheet" href="/static/css/base.css" />
  <link rel="stylesheet" href="/static/css/modal.css" />
  <link rel="stylesheet" href="/static/css/admin.css" />
</head>

<body>

  <!-- Theme Toggle Button -->
  <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark Mode">
    <span id="theme-icon">üåô</span>
  </button>

  <div class="container">
    <div class="header-container">
      <div>
        <h1>A.R.I.S.E. Admin Panel</h1>
        <h2 id="batch-identity-display"
          style="font-size: 1.1rem; color: var(--text-muted); margin-top: 0.2rem; font-weight: normal;">Loading
          Identity...</h2>
      </div>
      <button id="logout-button" class="button-danger">Logout</button>
    </div>

    <div class="tabs">
      <button class="tab-button" data-tab="settings">‚öôÔ∏è Settings</button>
      <button class="tab-button active" data-tab="manage">Manage Data</button>
      <button class="tab-button" data-tab="view">View Data</button>
      <button class="tab-button" data-tab="tools">Tools</button>
      <button class="tab-button" data-tab="analytics">Analytics</button>
    </div>

    <!-- ======================= SETTINGS TAB CONTENT ======================= -->
    <div id="settings" class="tab-content">
      <h2>System Settings</h2>
      <div class="management-section">
        <h3>Classroom / Batch Identity</h3>
        <p class="description" style="color: var(--text-muted); margin-bottom: 1rem;">
          Set the unique name for this classroom installation (e.g., "SBU MCA 2024-2026").
          This name will appear on all reports and analytics to identify this specific pod.
        </p>
        <form id="settings-form" class="management-form" style="max-width: 500px;">
          <div>
            <label for="setting-batch-name">Batch Name</label>
            <input type="text" id="setting-batch-name" placeholder="e.g. SBU MCA 2024-2026" required />
          </div>
          <button type="submit" class="button-primary" style="margin-top: 1rem;">Save Identity</button>
        </form>
      </div>
    </div>

    <!-- ======================= MANAGE DATA TAB CONTENT ======================= -->
    <div id="manage" class="tab-content active">
      <div class="sub-tabs">
        <button class="sub-tab-button active" data-subtab="semesters">
          1. Semesters
        </button>
        <button class="sub-tab-button" data-subtab="teachers">
          2. Teachers
        </button>
        <button class="sub-tab-button" data-subtab="students">
          3. Students
        </button>
        <button class="sub-tab-button" data-subtab="courses">
          4. Courses
        </button>
        <button class="sub-tab-button" data-subtab="enrollments">
          5. Course Enrollment
        </button>
      </div>

      <!-- Semester Management -->
      <div id="semesters" class="tab-content active">
        <h2>Semester Management</h2>
        <form id="semester-form" class="management-form">
          <input type="hidden" id="semester-id" />
          <div>
            <label for="semester-name">Semester Name (e.g., Fall 2025)</label>
            <input type="text" id="semester-name" required />
          </div>
          <button type="submit" class="button-primary" id="semester-submit-button">
            Add Semester
          </button>
        </form>
        <h3>Existing Semesters</h3>
        <table class="data-table">
          <thead>
            <tr>
              <th data-field="id">ID</th>
              <th data-field="semester_name">Semester Name</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="semesters-table-body"></tbody>
        </table>
      </div>

      <!-- Teacher Management -->
      <div id="teachers" class="tab-content">
        <h2>Teacher Management</h2>
        <form id="teacher-form" class="management-form">
          <input type="hidden" id="teacher-id" />
          <div class="form-grid">
            <div>
              <label for="teacher-name">Teacher Full Name</label>
              <input type="text" id="teacher-name" required />
            </div>
            <div>
              <label for="teacher-pin">Teacher PIN</label>
              <input type="password" id="teacher-pin" />
            </div>
          </div>
          <button type="submit" class="button-primary" id="teacher-submit-button">
            Add Teacher
          </button>
        </form>
        <h3>Existing Teachers</h3>
        <table class="data-table">
          <thead>
            <tr>
              <th data-field="id">ID</th>
              <th data-field="teacher_name">Teacher Name</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="teachers-table-body"></tbody>
        </table>
      </div>

      <!-- Student Management -->
      <div id="students" class="tab-content">
        <h2>Student Management</h2>
        <form id="student-form" class="management-form">
          <input type="hidden" id="student-id" />
          <div class="form-grid">
            <div>
              <label for="student-name">Student Full Name</label>
              <input type="text" id="student-name" required />
            </div>
            <div>
              <label for="student-univ-roll">University Roll No.</label>
              <input type="text" id="student-univ-roll" required />
            </div>
            <div>
              <label for="student-enroll-no">Enrollment No.</label>
              <input type="text" id="student-enroll-no" required />
            </div>
            <div>
              <label for="student-email1">Official Email (Primary)</label>
              <input type="email" id="student-email1" required />
            </div>
            <div>
              <label for="student-email2">Secondary Email (Optional)</label>
              <input type="email" id="student-email2" />
            </div>
            <div>
              <label for="student-password">Initial/New Password</label>
              <input type="password" id="student-password" />
            </div>
          </div>
          <button type="submit" class="button-primary" id="student-submit-button">
            Add Student
          </button>
        </form>
        <h3>Existing Students</h3>
        <table class="data-table">
          <thead>
            <tr>
              <th data-field="id">ID</th>
              <th data-field="student_name">Name</th>
              <th data-field="university_roll_no">Univ. Roll No.</th>
              <th data-field="enrollment_no">Enrollment No.</th>
              <th data-field="emails">Emails</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="students-table-body"></tbody>
        </table>
      </div>

      <!-- Course Management -->
      <div id="courses" class="tab-content">
        <h2>Course Management</h2>
        <form id="course-form" class="management-form">
          <input type="hidden" id="course-id" />
          <div class="form-grid">
            <div>
              <label for="course-name">Course Name</label>
              <input type="text" id="course-name" required />
            </div>
            <div>
              <label for="course-code">Course Code (Unique)</label>
              <input type="text" id="course-code" required />
            </div>
            <div>
              <label for="default-duration">Default Duration (minutes)</label>
              <input type="number" id="default-duration" value="30" required />
            </div>
            <div>
              <label for="select-semester">Select Semester</label>
              <select id="select-semester" required>
                <option value="">-- Loading Semesters --</option>
              </select>
            </div>
            <div>
              <label for="select-teacher">Assign Teacher</label>
              <select id="select-teacher" required>
                <option value="">-- Loading Teachers --</option>
              </select>
            </div>
          </div>
          <button type="submit" class="button-primary" id="course-submit-button">
            Add Course
          </button>
        </form>
        <h3>Existing Courses</h3>
        <table class="data-table">
          <thead>
            <tr>
              <th data-field="id">ID</th>
              <th data-field="course_name">Course Name</th>
              <th data-field="course_code">Course Code</th>
              <th data-field="semester_name">Semester</th>
              <th data-field="teacher_name">Teacher</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="courses-table-body"></tbody>
        </table>
      </div>

      <!-- Course Enrollment Management -->
      <div id="enrollments" class="tab-content">
        <h2>Course Enrollment Management</h2>
        <div class="enrollment-header">
          <label for="select-enrollment-course">Select a Course to Manage Enrollment:</label>
          <select id="select-enrollment-course">
            <option value="">-- Select a Course --</option>
          </select>
        </div>
        <div id="enrollment-ui" class="enrollment-container" style="display: none">
          <div class="student-list-box available-box">
            <div class="box-header">
              <h3>Available Students</h3>
              <div class="available-controls">
                <button id="select-all-available" class="button-secondary small" type="button">Select All</button>
                <button id="deselect-all-available" class="button-secondary small" type="button">Deselect All</button>
              </div>
            </div>

            <table class="data-table available-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th class="right">Univ. Roll No.</th>
                </tr>
              </thead>
              <tbody id="available-students-list">
                <!-- JS will insert <tr> rows here -->
              </tbody>
            </table>
          </div>
          <div class="enrollment-controls">
            <button class="enroll-button" id="enroll-button" title="Enroll Selected">
              &gt;&gt;
            </button>
            <button class="unenroll-button" id="unenroll-button" title="Unenroll Selected">
              &lt;&lt;
            </button>
          </div>
          <div class="student-list-box enrolled-box">
            <div class="box-header">
              <h3>Enrolled Students</h3>
              <div class="available-controls">
                <button id="select-all-enrolled" class="button-secondary small" type="button">Select All</button>
                <button id="deselect-all-enrolled" class="button-secondary small" type="button">Deselect All</button>
              </div>
            </div>

            <table class="data-table enrolled-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th class="right">Class Roll ID</th>
                </tr>
              </thead>
              <tbody id="enrolled-students-table-body"></tbody>
            </table>
          </div>
        </div>
        <button id="save-enrollments-button" class="button-primary" style="margin-top: 1rem">
          Save Enrollments for this Course
        </button>
      </div>
    </div>

    <!-- ======================= VIEW DATA TAB CONTENT ======================= -->
    <div id="view" class="tab-content">
      <div class="sub-tabs">
        <button class="sub-tab-button active" data-subtab="view-students">
          Students
        </button>
        <button class="sub-tab-button" data-subtab="view-teachers">
          Teachers
        </button>
        <button class="sub-tab-button" data-subtab="view-semesters">
          Semesters
        </button>
        <button class="sub-tab-button" data-subtab="view-courses">
          Courses
        </button>
        <!-- NEW: Sub-tab for the Enrollment Roster -->
        <button class="sub-tab-button" data-subtab="enrollment-roster">
          Enrollment Roster
        </button>
      </div>

      <!-- View Students -->
      <div id="view-students" class="tab-content active">
        <h3>All Students (Read-Only)</h3>
        <table class="data-table">
          <thead>
            <tr>
              <th data-field="id">ID</th>
              <th data-field="student_name">Name</th>
              <th data-field="university_roll_no">Univ. Roll No.</th>
              <th data-field="enrollment_no">Enrollment No.</th>
              <th data-field="emails">Emails</th>
            </tr>
          </thead>
          <tbody id="view-students-table-body"></tbody>
        </table>
      </div>
      <!-- View Teachers -->
      <div id="view-teachers" class="tab-content">
        <h3>All Teachers (Read-Only)</h3>
        <table class="data-table">
          <thead>
            <tr>
              <th data-field="id">ID</th>
              <th data-field="teacher_name">Teacher Name</th>
              <th data-field="pin">PIN</th>

            </tr>
          </thead>
          <tbody id="view-teachers-table-body"></tbody>
        </table>
      </div>
      <!-- View Semesters -->
      <div id="view-semesters" class="tab-content">
        <h3>All Semesters (Read-Only)</h3>
        <table class="data-table">
          <thead>
            <tr>
              <th data-field="id">ID</th>
              <th data-field="semester_name">Semester Name</th>
            </tr>
          </thead>
          <tbody id="view-semesters-table-body"></tbody>
        </table>
      </div>
      <!-- View Courses -->
      <div id="view-courses" class="tab-content">
        <h3>All Courses (Read-Only)</h3>
        <table class="data-table">
          <thead>
            <tr>
              <th data-field="id">ID</th>
              <th data-field="course_name">Course Name</th>
              <th data-field="course_code">Course Code</th>
              <th data-field="semester_name">Semester</th>
              <th data-field="teacher_name">Teacher</th>
            </tr>
          </thead>
          <tbody id="view-courses-table-body"></tbody>
        </table>
      </div>
      <!-- NEW: Enrollment Roster View -->
      <div id="enrollment-roster" class="tab-content">
        <h2>Enrollment Roster for Enrollment Day</h2>
        <div class="enrollment-header">
          <label for="select-roster-semester">Select a Semester to View Roster:</label>
          <select id="select-roster-semester">
            <option value="">-- Select a Semester --</option>
          </select>
        </div>
        <table class="data-table">
          <thead>
            <tr>
              <th>Class Roll ID</th>
              <th>Student Name</th>
              <th>University Roll No.</th>
              <th>Enrolled Courses (Course Codes)</th>
            </tr>
          </thead>
          <tbody id="enrollment-roster-table-body"></tbody>
        </table>
      </div>
    </div>

    <!-- ======================= TOOLS TAB CONTENT ======================= -->
    <div id="tools" class="tab-content">
      <h2>Tools</h2>
      <div class="management-section">
        <h3>Enrollment ID Calculator</h3>
        <div class="form-grid">
          <div>
            <label for="calc-roll-id">Enter Class Roll ID:</label>
            <input type="number" id="calc-roll-id" />
            <p>
              Slot 1: <strong id="slot1-result">--</strong> | Slot 2:
              <strong id="slot2-result">--</strong>
            </p>
          </div>
          <div>
            <label for="calc-slot-id">Enter Sensor Memory Slot ID:</label>
            <input type="number" id="calc-slot-id" />
            <p>
              Belongs to Class Roll ID:
              <strong id="roll-id-result">--</strong>
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- ======================= ANALYTICS TAB CONTENT ======================= -->
    <div id="analytics" class="tab-content">
      <h2>üìä Analytics Dashboard</h2>

      <div class="sub-tabs">
        <button class="sub-tab-button active" data-subtab="analytics-overview">Overview</button>
        <button class="sub-tab-button" data-subtab="analytics-course">Course Analytics</button>
        <button class="sub-tab-button" data-subtab="analytics-student">Student Lookup</button>
        <button class="sub-tab-button" data-subtab="analytics-trends">Trends</button>
      </div>

      <!-- ========== OVERVIEW ========== -->
      <div id="analytics-overview" class="tab-content active">
        <div class="kpi-grid">
          <div class="kpi-card kpi-blue">
            <div class="kpi-icon">üë•</div>
            <div class="kpi-value" id="kpi-total-students">--</div>
            <div class="kpi-label">Total Students</div>
          </div>
          <div class="kpi-card kpi-purple">
            <div class="kpi-icon">üìö</div>
            <div class="kpi-value" id="kpi-total-courses">--</div>
            <div class="kpi-label">Courses</div>
          </div>
          <div class="kpi-card kpi-green">
            <div class="kpi-icon">üìã</div>
            <div class="kpi-value" id="kpi-total-sessions">--</div>
            <div class="kpi-label">Total Sessions</div>
          </div>
          <div class="kpi-card kpi-gold">
            <div class="kpi-icon">üìà</div>
            <div class="kpi-value" id="kpi-overall-rate">--%</div>
            <div class="kpi-label">Overall Attendance</div>
          </div>
          <div class="kpi-card kpi-red">
            <div class="kpi-icon">‚ö†Ô∏è</div>
            <div class="kpi-value" id="kpi-at-risk">--</div>
            <div class="kpi-label">At-Risk Students</div>
          </div>
          <div class="kpi-card kpi-teal">
            <div class="kpi-icon">üåê</div>
            <div class="kpi-value" id="kpi-online-sessions">--</div>
            <div class="kpi-label">Online Sessions</div>
          </div>
          <div class="kpi-card kpi-orange">
            <div class="kpi-icon">üìÖ</div>
            <div class="kpi-value" id="kpi-sessions-week">--</div>
            <div class="kpi-label">This Week</div>
          </div>
          <div class="kpi-card kpi-cyan">
            <div class="kpi-icon">üìä</div>
            <div class="kpi-value" id="kpi-avg-attendance">--</div>
            <div class="kpi-label">Avg per Session</div>
          </div>
        </div>

        <h3>Course-wise Summary</h3>
        <table class="data-table">
          <thead>
            <tr>
              <th>Course Code</th>
              <th>Course Name</th>
              <th>Teacher</th>
              <th>Enrolled</th>
              <th>Sessions</th>
              <th>Attendance %</th>
            </tr>
          </thead>
          <tbody id="course-summary-tbody"></tbody>
        </table>
      </div>

      <!-- ========== COURSE ANALYTICS ========== -->
      <div id="analytics-course" class="tab-content">
        <div class="analytics-controls">
          <label for="analytics-course-select">Select Course:</label>
          <select id="analytics-course-select">
            <option value="">-- Select a Course --</option>
          </select>
        </div>

        <div id="course-analytics-content" style="display:none;">
          <div class="course-info-bar">
            <span id="ca-course-name"></span>
            <span id="ca-teacher"></span>
            <span id="ca-semester"></span>
          </div>

          <div class="kpi-grid kpi-grid-small">
            <div class="kpi-card kpi-blue">
              <div class="kpi-value" id="ca-enrolled">--</div>
              <div class="kpi-label">Enrolled</div>
            </div>
            <div class="kpi-card kpi-green">
              <div class="kpi-value" id="ca-sessions">--</div>
              <div class="kpi-label">Sessions</div>
            </div>
            <div class="kpi-card kpi-red">
              <div class="kpi-value" id="ca-at-risk">--</div>
              <div class="kpi-label">At Risk</div>
            </div>
          </div>

          <h3>üìà Attendance Trend</h3>
          <div class="chart-container"><canvas id="course-trend-chart"></canvas></div>

          <h3>Per-Student Attendance</h3>
          <input type="text" id="ca-student-search" placeholder="Search by name or roll..." autocomplete="off" />
          <table class="data-table">
            <thead>
              <tr>
                <th>Class Roll</th>
                <th>Name</th>
                <th>Univ. Roll</th>
                <th>Present</th>
                <th>Total</th>
                <th>%</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="ca-students-tbody"></tbody>
          </table>
        </div>
      </div>

      <!-- ========== STUDENT LOOKUP ========== -->
      <div id="analytics-student" class="tab-content">
        <div class="analytics-controls">
          <label for="student-lookup-select">Select Student:</label>
          <select id="student-lookup-select">
            <option value="">-- Select a Student --</option>
          </select>
        </div>

        <div id="student-analytics-content" style="display:none;">
          <div class="student-profile-card">
            <h3 id="sa-student-name"></h3>
            <p id="sa-student-roll"></p>
            <div class="sa-overall-badge" id="sa-overall-badge">--</div>
          </div>

          <h3>Attendance per Course</h3>
          <table class="data-table">
            <thead>
              <tr>
                <th>Course Code</th>
                <th>Course Name</th>
                <th>Class Roll</th>
                <th>Present</th>
                <th>Total</th>
                <th>%</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="sa-courses-tbody"></tbody>
          </table>

          <h3>Recent Absences</h3>
          <table class="data-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Course</th>
              </tr>
            </thead>
            <tbody id="sa-absences-tbody"></tbody>
          </table>
        </div>
      </div>

      <!-- ========== TRENDS ========== -->
      <div id="analytics-trends" class="tab-content">
        <div class="charts-grid">
          <div class="chart-card">
            <h3>üìà Daily Attendance (Last 30 Days)</h3>
            <div class="chart-container"><canvas id="daily-trend-chart"></canvas></div>
          </div>
          <div class="chart-card">
            <h3>üìÖ Day-of-Week Pattern</h3>
            <div class="chart-container"><canvas id="dow-chart"></canvas></div>
          </div>
          <div class="chart-card">
            <h3>üåê Online vs Offline</h3>
            <div class="chart-container chart-container-small"><canvas id="type-split-chart"></canvas></div>
          </div>
          <div class="chart-card">
            <h3>üìö Course Comparison</h3>
            <div class="chart-container"><canvas id="course-comparison-chart"></canvas></div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- JavaScript Files -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="/static/js/modal.js"></script>
  <script src="/static/js/admin.js"></script>
  <script src="/static/js/admin-analytics.js"></script>
</body>

</html>